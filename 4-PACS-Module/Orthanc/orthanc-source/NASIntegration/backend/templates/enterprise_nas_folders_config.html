<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè• Enterprise NAS Shared Folders Configuration</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .enterprise-header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .nas-device-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            overflow: hidden;
            border: 2px solid #e9ecef;
        }
        
        .nas-device-header {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 1.5rem;
            border-bottom: none;
        }
        
        .shared-folder-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .shared-folder-item:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .procedure-badge {
            position: absolute;
            top: -8px;
            right: 15px;
            background: #e74c3c;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .procedure-badge.CT { background: #e74c3c; }
        .procedure-badge.MRI { background: #9b59b6; }
        .procedure-badge.XRAY { background: #f39c12; }
        .procedure-badge.ULTRASOUND { background: #27ae60; }
        .procedure-badge.NUCLEAR { background: #34495e; }
        .procedure-badge.PATHOLOGY { background: #e67e22; }
        
        .connection-status {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-success { background: #27ae60; }
        .status-warning { background: #f39c12; }
        .status-error { background: #e74c3c; }
        .status-unknown { background: #95a5a6; }
        
        .add-folder-form {
            background: #ecf0f1;
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 1rem;
            display: none;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .btn-enterprise {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            transition: all 0.3s ease;
        }
        
        .btn-enterprise:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
            color: white;
        }
        
        .btn-test {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            border: none;
            color: white;
        }
        
        .btn-delete {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            border: none;
            color: white;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #3498db;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .alert-custom {
            border-radius: 10px;
            border: none;
            padding: 1rem 1.5rem;
        }
        
        .credentials-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 5px 5px 0;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container-fluid p-4">
        <!-- Enterprise Header -->
        <div class="enterprise-header">
            <h1><i class="fas fa-network-wired"></i> üè• Enterprise NAS Shared Folders Configuration</h1>
            <p class="mb-0">Ubuntu Patient Care - Multi-Procedure Medical Imaging Storage Management</p>
            <small>Configure shared folders for different medical procedures across multiple NAS devices</small>
        </div>
        
        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalDevices">0</div>
                <div>NAS Devices</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalFolders">0</div>
                <div>Shared Folders</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="activeProcedures">0</div>
                <div>Active Procedures</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="successRate">0%</div>
                <div>Connection Success</div>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="row mb-4">
            <div class="col-md-6">
                <button class="btn btn-enterprise" onclick="addNewNASDevice()">
                    <i class="fas fa-plus"></i> Add NAS Device
                </button>
                <button class="btn btn-test" onclick="testAllConnections()">
                    <i class="fas fa-check-circle"></i> Test All Connections
                </button>
            </div>
            <div class="col-md-6 text-end">
                <button class="btn btn-outline-primary" onclick="exportConfiguration()">
                    <i class="fas fa-download"></i> Export Config
                </button>
                <button class="btn btn-outline-secondary" onclick="importConfiguration()">
                    <i class="fas fa-upload"></i> Import Config
                </button>
                <button class="btn btn-outline-info" onclick="refreshData()">
                    <i class="fas fa-sync"></i> Refresh
                </button>
            </div>
        </div>
        
        <!-- Alert Area -->
        <div id="alertArea"></div>
        
        <!-- NAS Devices List -->
        <div id="nasDevicesList">
            <!-- Devices will be loaded here dynamically -->
        </div>
        
        <!-- Add NAS Device Modal -->
        <div class="modal fade" id="addNASModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Add New NAS Device</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="addNASForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Device Name *</label>
                                        <input type="text" class="form-control" id="deviceName" required 
                                               placeholder="Primary Medical NAS">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>IP Address *</label>
                                        <input type="text" class="form-control" id="ipAddress" required 
                                               placeholder="192.168.1.100" pattern="^([0-9]{1,3}\.){3}[0-9]{1,3}$">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Manufacturer</label>
                                        <select class="form-control" id="manufacturer">
                                            <option value="Synology">Synology</option>
                                            <option value="QNAP">QNAP</option>
                                            <option value="Buffalo">Buffalo</option>
                                            <option value="Netgear">Netgear</option>
                                            <option value="Drobo">Drobo</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Model</label>
                                        <input type="text" class="form-control" id="model" placeholder="DS920+">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Default Domain</label>
                                        <input type="text" class="form-control" id="defaultDomain" placeholder="HOSPITAL">
                                    </div>
                                </div>
                            </div>
                            <div class="credentials-warning">
                                <i class="fas fa-shield-alt"></i> <strong>Admin Credentials (Optional)</strong><br>
                                These will be encrypted and stored securely for device management.
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Admin Username</label>
                                        <input type="text" class="form-control" id="adminUsername" placeholder="admin">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Admin Password</label>
                                        <input type="password" class="form-control" id="adminPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-enterprise" onclick="saveNASDevice()">Add Device</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Add Shared Folder Modal -->
        <div class="modal fade" id="addFolderModal" tabindex="-1">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Add Shared Folder for Medical Procedure</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="addFolderForm">
                            <input type="hidden" id="folderNASDeviceId">
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Medical Procedure Type *</label>
                                        <select class="form-control" id="procedureType" required onchange="updateProcedureDefaults()">
                                            <option value="">Select Procedure...</option>
                                            <option value="CT">CT Scans</option>
                                            <option value="MRI">MRI Studies</option>
                                            <option value="XRAY">X-Ray Imaging</option>
                                            <option value="ULTRASOUND">Ultrasound</option>
                                            <option value="NUCLEAR">Nuclear Medicine</option>
                                            <option value="PATHOLOGY">Digital Pathology</option>
                                            <option value="MAMMOGRAPHY">Mammography</option>
                                            <option value="FLUOROSCOPY">Fluoroscopy</option>
                                            <option value="ENDOSCOPY">Endoscopy</option>
                                            <option value="CARDIOLOGY">Cardiac Imaging</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Priority (1-10)</label>
                                        <input type="number" class="form-control" id="priority" min="1" max="10" value="5">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Share Name *</label>
                                        <input type="text" class="form-control" id="shareName" required 
                                               placeholder="ct_scans">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Share Path *</label>
                                        <input type="text" class="form-control" id="sharePath" required 
                                               placeholder="//192.168.1.100/ct_scans">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="credentials-warning">
                                <i class="fas fa-lock"></i> <strong>Access Credentials</strong><br>
                                Specific username/password for this shared folder. Will be encrypted and stored securely.
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Username *</label>
                                        <input type="text" class="form-control" id="shareUsername" required 
                                               placeholder="ct_user">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Password *</label>
                                        <input type="password" class="form-control" id="sharePassword" required 
                                               placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Domain</label>
                                        <input type="text" class="form-control" id="shareDomain" placeholder="HOSPITAL">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Protocol</label>
                                        <select class="form-control" id="protocol">
                                            <option value="SMB">SMB/CIFS</option>
                                            <option value="NFS">NFS</option>
                                            <option value="FTP">FTP</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Compression Type</label>
                                        <select class="form-control" id="compressionType">
                                            <option value="DICOM">DICOM</option>
                                            <option value="JPEG2000">JPEG2000</option>
                                            <option value="TIFF">TIFF</option>
                                            <option value="JPEG">JPEG</option>
                                            <option value="PNG">PNG</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Database Format</label>
                                        <select class="form-control" id="databaseFormat">
                                            <option value="DICOM">DICOM</option>
                                            <option value="FIREBIRD">Firebird</option>
                                            <option value="SQLITE">SQLite</option>
                                            <option value="MYSQL">MySQL</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Mount Point</label>
                                        <input type="text" class="form-control" id="mountPoint" placeholder="/mnt/ct_scans">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="autoMount" checked>
                                        <label class="form-check-label" for="autoMount">
                                            Auto-mount on system startup
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="readOnly">
                                        <label class="form-check-label" for="readOnly">
                                            Read-only access
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-test" onclick="testFolderConnection()">
                            <i class="fas fa-check"></i> Test Connection
                        </button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-enterprise" onclick="saveSharedFolder()">Add Folder</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <h5>Processing...</h5>
            <p id="loadingMessage">Please wait while we process your request.</p>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let nasDevices = [];
        let procedureTypes = [];
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadNASDevices();
            loadProcedureTypes();
        });
        
        // Show/hide loading overlay
        function showLoading(message = 'Processing...') {
            document.getElementById('loadingMessage').textContent = message;
            document.getElementById('loadingOverlay').style.display = 'flex';
        }
        
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }
        
        // Show alerts
        function showAlert(message, type = 'info') {
            const alertArea = document.getElementById('alertArea');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-custom alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            alertArea.appendChild(alertDiv);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }
        
        // Load NAS devices from backend
        async function loadNASDevices() {
            showLoading('Loading NAS devices...');
            try {
                // This would call your backend API
                // const response = await fetch('/api/enterprise-nas/devices');
                // const data = await response.json();
                
                // Mock data for demo
                nasDevices = [
                    {
                        device_id: 'nas_192_168_1_100',
                        device_name: 'Primary Medical NAS',
                        ip_address: '192.168.1.100',
                        manufacturer: 'Synology',
                        model: 'DS920+',
                        shared_folders: [
                            {
                                folder_id: 'nas_192_168_1_100_CT_ct_scans',
                                procedure_type: 'CT',
                                share_name: 'ct_scans',
                                share_path: '//192.168.1.100/ct_scans',
                                username: 'ct_user',
                                protocol: 'SMB',
                                compression_type: 'DICOM',
                                database_format: 'DICOM',
                                priority: 9,
                                last_successful: '2025-09-23T10:30:00'
                            }
                        ]
                    }
                ];
                
                renderNASDevices();
                updateStatistics();
                hideLoading();
            } catch (error) {
                hideLoading();
                showAlert('Error loading NAS devices: ' + error.message, 'danger');
            }
        }
        
        // Render NAS devices
        function renderNASDevices() {
            const container = document.getElementById('nasDevicesList');
            container.innerHTML = '';
            
            nasDevices.forEach(device => {
                const deviceHTML = `
                    <div class="nas-device-card">
                        <div class="nas-device-header">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h4><i class="fas fa-server"></i> ${device.device_name}</h4>
                                    <p class="mb-0">
                                        <i class="fas fa-network-wired"></i> ${device.ip_address} | 
                                        <i class="fas fa-building"></i> ${device.manufacturer} ${device.model}
                                    </p>
                                </div>
                                <div class="col-md-4 text-end">
                                    <button class="btn btn-light btn-sm" onclick="addSharedFolder('${device.device_id}')">
                                        <i class="fas fa-plus"></i> Add Folder
                                    </button>
                                    <button class="btn btn-outline-light btn-sm" onclick="editNASDevice('${device.device_id}')">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-3">
                            <div id="folders_${device.device_id}">
                                ${renderSharedFolders(device.shared_folders, device.device_id)}
                            </div>
                            ${device.shared_folders.length === 0 ? 
                                '<div class="text-center py-4 text-muted"><i class="fas fa-folder-open"></i> No shared folders configured</div>' : 
                                ''
                            }
                        </div>
                    </div>
                `;
                container.innerHTML += deviceHTML;
            });
        }
        
        // Render shared folders for a device
        function renderSharedFolders(folders, deviceId) {
            return folders.map(folder => {
                const statusClass = folder.last_successful ? 'status-success' : 'status-unknown';
                const lastTested = folder.last_successful ? 
                    new Date(folder.last_successful).toLocaleString() : 'Never tested';
                    
                return `
                    <div class="shared-folder-item">
                        <div class="procedure-badge ${folder.procedure_type}">${folder.procedure_type}</div>
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h6>
                                    <span class="connection-status ${statusClass}"></span>
                                    <i class="fas fa-folder"></i> ${folder.share_name}
                                </h6>
                                <div class="small text-muted">
                                    <i class="fas fa-link"></i> ${folder.share_path} | 
                                    <i class="fas fa-user"></i> ${folder.username} | 
                                    <i class="fas fa-cog"></i> ${folder.protocol} |
                                    <i class="fas fa-compress"></i> ${folder.compression_type}
                                </div>
                                <div class="small text-muted">
                                    Last tested: ${lastTested}
                                </div>
                            </div>
                            <div class="col-md-4 text-end">
                                <div class="btn-group" role="group">
                                    <button class="btn btn-test btn-sm" onclick="testFolderConnectionById('${folder.folder_id}')" 
                                            title="Test Connection">
                                        <i class="fas fa-check"></i>
                                    </button>
                                    <button class="btn btn-outline-primary btn-sm" onclick="editSharedFolder('${folder.folder_id}')" 
                                            title="Edit Folder">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-delete btn-sm" onclick="deleteSharedFolder('${folder.folder_id}')" 
                                            title="Delete Folder">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Update statistics
        function updateStatistics() {
            const totalDevices = nasDevices.length;
            const totalFolders = nasDevices.reduce((sum, device) => sum + device.shared_folders.length, 0);
            const activeProcedures = new Set(
                nasDevices.flatMap(device => device.shared_folders.map(folder => folder.procedure_type))
            ).size;
            
            const testedFolders = nasDevices.flatMap(device => device.shared_folders)
                .filter(folder => folder.last_successful);
            const successRate = totalFolders > 0 ? Math.round((testedFolders.length / totalFolders) * 100) : 0;
            
            document.getElementById('totalDevices').textContent = totalDevices;
            document.getElementById('totalFolders').textContent = totalFolders;
            document.getElementById('activeProcedures').textContent = activeProcedures;
            document.getElementById('successRate').textContent = successRate + '%';
        }
        
        // Add new NAS device
        function addNewNASDevice() {
            const modal = new bootstrap.Modal(document.getElementById('addNASModal'));
            modal.show();
        }
        
        // Save NAS device
        async function saveNASDevice() {
            const form = document.getElementById('addNASForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const deviceData = {
                device_name: document.getElementById('deviceName').value,
                ip_address: document.getElementById('ipAddress').value,
                manufacturer: document.getElementById('manufacturer').value,
                model: document.getElementById('model').value,
                default_domain: document.getElementById('defaultDomain').value,
                admin_username: document.getElementById('adminUsername').value,
                admin_password: document.getElementById('adminPassword').value
            };
            
            showLoading('Adding NAS device...');
            try {
                // Call backend API
                // const response = await fetch('/api/enterprise-nas/devices', {
                //     method: 'POST',
                //     headers: { 'Content-Type': 'application/json' },
                //     body: JSON.stringify(deviceData)
                // });
                
                // Mock success
                hideLoading();
                showAlert('NAS device added successfully!', 'success');
                bootstrap.Modal.getInstance(document.getElementById('addNASModal')).hide();
                loadNASDevices();
            } catch (error) {
                hideLoading();
                showAlert('Error adding NAS device: ' + error.message, 'danger');
            }
        }
        
        // Add shared folder
        function addSharedFolder(deviceId) {
            document.getElementById('folderNASDeviceId').value = deviceId;
            const modal = new bootstrap.Modal(document.getElementById('addFolderModal'));
            modal.show();
        }
        
        // Update procedure defaults when procedure type changes
        function updateProcedureDefaults() {
            const procedureType = document.getElementById('procedureType').value;
            const defaults = {
                'CT': { compression: 'DICOM', database: 'DICOM', protocol: 'SMB' },
                'MRI': { compression: 'DICOM', database: 'FIREBIRD', protocol: 'SMB' },
                'XRAY': { compression: 'JPEG2000', database: 'FIREBIRD', protocol: 'SMB' },
                'ULTRASOUND': { compression: 'JPEG', database: 'SQLITE', protocol: 'SMB' },
                'NUCLEAR': { compression: 'DICOM', database: 'DICOM', protocol: 'SMB' },
                'PATHOLOGY': { compression: 'TIFF', database: 'SQLITE', protocol: 'SMB' }
            };
            
            if (defaults[procedureType]) {
                document.getElementById('compressionType').value = defaults[procedureType].compression;
                document.getElementById('databaseFormat').value = defaults[procedureType].database;
                document.getElementById('protocol').value = defaults[procedureType].protocol;
            }
        }
        
        // Test folder connection
        async function testFolderConnection() {
            showLoading('Testing folder connection...');
            try {
                // Mock test
                await new Promise(resolve => setTimeout(resolve, 2000));
                hideLoading();
                showAlert('Connection test successful!', 'success');
            } catch (error) {
                hideLoading();
                showAlert('Connection test failed: ' + error.message, 'danger');
            }
        }
        
        // Test folder connection by ID
        async function testFolderConnectionById(folderId) {
            showLoading('Testing connection...');
            try {
                // Call backend API
                // const response = await fetch(`/api/enterprise-nas/folders/${folderId}/test`);
                // const result = await response.json();
                
                // Mock test
                await new Promise(resolve => setTimeout(resolve, 1000));
                hideLoading();
                showAlert(`Connection test successful for folder: ${folderId}`, 'success');
            } catch (error) {
                hideLoading();
                showAlert('Connection test failed: ' + error.message, 'danger');
            }
        }
        
        // Test all connections
        async function testAllConnections() {
            showLoading('Testing all folder connections...');
            try {
                // Call backend API
                await new Promise(resolve => setTimeout(resolve, 3000));
                hideLoading();
                showAlert('All connection tests completed!', 'info');
                loadNASDevices(); // Refresh to show updated test results
            } catch (error) {
                hideLoading();
                showAlert('Error testing connections: ' + error.message, 'danger');
            }
        }
        
        // Save shared folder
        async function saveSharedFolder() {
            const form = document.getElementById('addFolderForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            showLoading('Adding shared folder...');
            try {
                // Mock save
                await new Promise(resolve => setTimeout(resolve, 1000));
                hideLoading();
                showAlert('Shared folder added successfully!', 'success');
                bootstrap.Modal.getInstance(document.getElementById('addFolderModal')).hide();
                loadNASDevices();
            } catch (error) {
                hideLoading();
                showAlert('Error adding shared folder: ' + error.message, 'danger');
            }
        }
        
        // Refresh data
        function refreshData() {
            loadNASDevices();
            showAlert('Data refreshed successfully!', 'info');
        }
        
        // Placeholder functions
        function editNASDevice(deviceId) {
            showAlert('Edit NAS device functionality coming soon!', 'info');
        }
        
        function editSharedFolder(folderId) {
            showAlert('Edit shared folder functionality coming soon!', 'info');
        }
        
        function deleteSharedFolder(folderId) {
            if (confirm('Are you sure you want to delete this shared folder?')) {
                showAlert('Shared folder deleted successfully!', 'success');
                loadNASDevices();
            }
        }
        
        function exportConfiguration() {
            showAlert('Export configuration functionality coming soon!', 'info');
        }
        
        function importConfiguration() {
            showAlert('Import configuration functionality coming soon!', 'info');
        }
        
        function loadProcedureTypes() {
            // This would load from backend
            procedureTypes = [
                { code: 'CT', name: 'CT Scans', description: 'Computed Tomography imaging' },
                { code: 'MRI', name: 'MRI Studies', description: 'Magnetic Resonance Imaging' },
                // ... more procedure types
            ];
        }
    </script>
</body>
</html>